---
name: markdown-helper
description: Markdownæ–‡æ¡£ç¼–å†™è¾…åŠ©ã€‚å½“ç”¨æˆ·éœ€è¦åœ¨markdownæ–‡æ¡£ä¸­ç”ŸæˆUMLå›¾è¡¨ã€æ£€æŸ¥æ ¼å¼ã€ç”Ÿæˆç›®å½•æ—¶ä½¿ç”¨æ­¤skillã€‚
---

# Markdownæ–‡æ¡£ç¼–å†™è¾…åŠ©

æä¾›Markdownæ–‡æ¡£ç¼–å†™è¿‡ç¨‹ä¸­çš„UMLå›¾è¡¨ç”Ÿæˆã€æ ¼å¼æ£€æŸ¥ã€ç›®å½•ç”Ÿæˆç­‰è¾…åŠ©åŠŸèƒ½ã€‚

## ä½¿ç”¨æ–¹æ³•

å½“ç”¨æˆ·è¯´ä»¥ä¸‹å†…å®¹æ—¶è§¦å‘ï¼š
- "ç”Ÿæˆç”¨ä¾‹å›¾"ã€"ç”Ÿæˆæµç¨‹å›¾"ã€"ç”Ÿæˆæ—¶åºå›¾"
- "ç”Ÿæˆç±»å›¾"ã€"ç”Ÿæˆæ´»åŠ¨å›¾"ã€"ç”Ÿæˆæ³³é“å›¾"
- "ç”ŸæˆçŠ¶æ€å›¾"ã€"ç”Ÿæˆç»„ä»¶å›¾"
- "æ£€æŸ¥markdownæ ¼å¼"ã€"ä¿®å¤æ ¼å¼"
- "ç”Ÿæˆç›®å½•"ã€"æ›´æ–°ç›®å½•"
- "æ’å…¥å›¾è¡¨"ã€"æ·»åŠ å›¾ç‰‡"

## å›¾è¡¨å·¥å…·é€‰æ‹©æŒ‡å—

### PlantUML vs Mermaid

æœ¬ skill ä¸»è¦ä½¿ç”¨ **PlantUML** ç”Ÿæˆ UML å»ºæ¨¡å›¾ï¼Œä½† **Mermaid** å’Œ **PlantUML** å¯ä»¥äº’è¡¥ä½¿ç”¨ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚

#### å·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | PlantUML | Mermaid |
|------|----------|---------|
| **ç”¨ä¾‹å›¾** | âœ… å®Œæ•´æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **ç±»å›¾** | âœ… å®Œæ•´æ”¯æŒ | âš ï¸ åŸºç¡€æ”¯æŒ |
| **æ—¶åºå›¾** | âœ… å®Œæ•´æ”¯æŒ | âœ… å®Œæ•´æ”¯æŒ |
| **æ´»åŠ¨å›¾/æµç¨‹å›¾** | âœ… æ´»åŠ¨å›¾ | âœ… æµç¨‹å›¾ï¼ˆæ›´ç®€æ´ï¼‰ |
| **çŠ¶æ€å›¾** | âœ… å®Œæ•´æ”¯æŒ | âœ… å®Œæ•´æ”¯æŒ |
| **æ€ç»´å¯¼å›¾** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **ç”˜ç‰¹å›¾** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **ERå›¾** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **UMLæ ‡å‡†** | âœ… å®Œå…¨ç¬¦åˆ | âš ï¸ éƒ¨åˆ†ç¬¦åˆ |
| **åœ¨çº¿æ¸²æŸ“** | âš ï¸ éœ€è¦æœåŠ¡å™¨ | âœ… GitHub/GitLabåŸç”Ÿæ”¯æŒ |
| **è½¬PNG** | âœ… åœ¨çº¿æœåŠ¡ï¼ˆæœ¬skillï¼‰ | âš ï¸ éœ€è¦CLIå·¥å…· |
| **è¯­æ³•å¤æ‚åº¦** | âš ï¸ è¾ƒå¤æ‚ | âœ… ç®€å•æ˜“å­¦ |

#### ä½¿ç”¨å»ºè®®

**ä½¿ç”¨ PlantUMLï¼ˆæœ¬skillé»˜è®¤ï¼‰**ï¼š
- ğŸ“ **æ ‡å‡†UMLå»ºæ¨¡å›¾**ï¼šç”¨ä¾‹å›¾ã€ç±»å›¾ã€ç»„ä»¶å›¾ã€éƒ¨ç½²å›¾
- ğŸ“„ **æ­£å¼é¡¹ç›®æ–‡æ¡£**ï¼šéœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€è®¾è®¡æ–‡æ¡£
- ğŸ¢ **ä¼ä¸šçº§æ–‡æ¡£**ï¼šéœ€è¦ç¬¦åˆUMLæ ‡å‡†
- ğŸ¯ **å¤æ‚ç³»ç»Ÿæ¶æ„**ï¼šå¤šå±‚æ¬¡çš„ç³»ç»Ÿè®¾è®¡

**ä½¿ç”¨ Mermaidï¼ˆéœ€è¦å•ç‹¬å¤„ç†ï¼‰**ï¼š
- ğŸ“ **GitHub/GitLabæ–‡æ¡£**ï¼šREADME.mdã€Wikiï¼ˆåŸç”Ÿæ”¯æŒï¼‰
- ğŸ’¡ **å¿«é€Ÿæµç¨‹å›¾**ï¼šä¸šåŠ¡æµç¨‹ã€å†³ç­–æ ‘
- ğŸ§  **æ€ç»´å¯¼å›¾**ï¼šçŸ¥è¯†ä½“ç³»ã€åŠŸèƒ½ç»“æ„
- ğŸ“Š **æ•°æ®å¯è§†åŒ–**ï¼šç”˜ç‰¹å›¾ã€é¥¼å›¾
- ğŸ”„ **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**ï¼šçº¯æ–‡æœ¬ï¼Œæ˜“äºdiff

#### é€‰æ‹©æµç¨‹

```
éœ€è¦ç”Ÿæˆå›¾è¡¨
    â†“
æ˜¯å¦éœ€è¦æ ‡å‡†UMLå›¾ï¼ˆç”¨ä¾‹å›¾/ç±»å›¾ï¼‰ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ PlantUMLï¼ˆæœ¬skillï¼‰
    â””â”€ å¦ â†’ æ˜¯å¦åœ¨GitHub/GitLabä¸Šå±•ç¤ºï¼Ÿ
            â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ Mermaidï¼ˆç›´æ¥åœ¨Markdownä¸­ï¼‰
            â””â”€ å¦ â†’ æ˜¯å¦éœ€è¦æ€ç»´å¯¼å›¾/ç”˜ç‰¹å›¾ï¼Ÿ
                    â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ Mermaid
                    â””â”€ å¦ â†’ ä¸¤è€…çš†å¯ï¼ŒPlantUMLæ›´æ ‡å‡†
```

#### æ³¨æ„äº‹é¡¹

- **æœ¬skillé»˜è®¤ä½¿ç”¨PlantUML**ï¼Œé€‚åˆæ­£å¼æ–‡æ¡£å’ŒUMLå»ºæ¨¡
- **Mermaidé€‚åˆå¿«é€Ÿç»˜å›¾**ï¼Œç‰¹åˆ«æ˜¯åœ¨GitHubç­‰å¹³å°ä¸Š
- **ä¸¤è€…å¯ä»¥åœ¨åŒä¸€é¡¹ç›®ä¸­æ··ç”¨**ï¼Œæ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©
- **å¦‚éœ€ä½¿ç”¨Mermaid**ï¼Œå¯ä»¥ç›´æ¥åœ¨Markdownä¸­ç¼–å†™ï¼Œæ— éœ€è½¬æ¢ä¸ºPNG

## æ ¸å¿ƒåŠŸèƒ½

### 1. UMLå›¾è¡¨ç”Ÿæˆï¼ˆPlantUMLï¼‰

#### æ”¯æŒçš„å›¾è¡¨ç±»å‹

| å›¾è¡¨ç±»å‹ | PlantUMLå…³é”®å­— | ä½¿ç”¨åœºæ™¯ |
|---------|--------------|---------|
| ç”¨ä¾‹å›¾ | `@startuml` + `usecase` | ç³»ç»ŸåŠŸèƒ½ã€ç”¨æˆ·äº¤äº’ |
| æ—¶åºå›¾ | `@startuml` + `participant` | ç³»ç»Ÿäº¤äº’ã€APIè°ƒç”¨ |
| ç±»å›¾ | `@startuml` + `class` | æ•°æ®æ¨¡å‹ã€ç±»ç»“æ„ |
| æ´»åŠ¨å›¾ | `@startuml` + `start`/`stop` | ä¸šåŠ¡æµç¨‹ã€å®¡æ‰¹æµç¨‹ |
| çŠ¶æ€å›¾ | `@startuml` + `state` | çŠ¶æ€æµè½¬ |
| ç»„ä»¶å›¾ | `@startuml` + `component` | ç³»ç»Ÿæ¶æ„ |
| éƒ¨ç½²å›¾ | `@startuml` + `node` | éƒ¨ç½²æ¶æ„ |
| å¯¹è±¡å›¾ | `@startuml` + `object` | å¯¹è±¡å…³ç³» |
| æ³³é“å›¾ | `@startuml` + `|æ³³é“å|` | è·¨éƒ¨é—¨æµç¨‹ |

#### æ‰§è¡Œæµç¨‹

**æ­¥éª¤1ï¼šç”ŸæˆPlantUMLä»£ç **

æ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆå¯¹åº”çš„PlantUMLä»£ç ã€‚

**æ­¥éª¤2ï¼šä¿å­˜ä¸º.pumlæ–‡ä»¶**

å°†PlantUMLä»£ç ä¿å­˜åˆ°scriptsç›®å½•ï¼š

```bash
# ç¡®ä¿scriptsç›®å½•å­˜åœ¨
mkdir -p scripts

# ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶
cat > "scripts/temp_diagram_$(date +%s).puml" << 'EOF'
@startuml
[PlantUMLä»£ç å†…å®¹]
@enduml
EOF
```

**æ­¥éª¤3ï¼šä½¿ç”¨Node.jsè„šæœ¬è½¬æ¢ä¸ºPNGå›¾ç‰‡**

ä½¿ç”¨é€šç”¨è½¬æ¢è„šæœ¬ `scripts/plantuml-to-png.js`ï¼š

```javascript
// è¯¥è„šæœ¬ä¼šï¼š
// 1. è¯»å–.pumlæ–‡ä»¶
// 2. å‹ç¼©å¹¶ç¼–ç ä¸ºPlantUMLæ ¼å¼
// 3. è°ƒç”¨PlantUMLåœ¨çº¿æœåŠ¡ç”ŸæˆPNG
// 4. ä¿å­˜åˆ°imagesç›®å½•
```

æ‰§è¡Œå‘½ä»¤ï¼š

```bash
# è½¬æ¢å•ä¸ªæ–‡ä»¶
node scripts/plantuml-to-png.js scripts/temp_diagram.puml images/output.png

# æˆ–ä½¿ç”¨æ‰¹é‡è½¬æ¢
node scripts/plantuml-to-png.js scripts/*.puml
```

**æ­¥éª¤4ï¼šæ¸…ç†ä¸´æ—¶æ–‡ä»¶**

```bash
# æ¸…ç†ä¸´æ—¶.pumlæ–‡ä»¶
rm -f scripts/temp_diagram*.puml
```

**æ­¥éª¤5ï¼šæ’å…¥å›¾ç‰‡å¼•ç”¨**

åœ¨markdownæ–‡æ¡£ä¸­æ’å…¥ï¼š

```markdown
![å›¾è¡¨æè¿°](../../../images/xxx.png)
```

#### PlantUMLæ ·å¼è§„èŒƒ

**ä¸»é¢˜è®¾ç½®**ï¼š

```plantuml
@startuml
!theme plain
skinparam actorStyle awesome
skinparam packageStyle rectangle
@enduml
```

**é¢œè‰²æ–¹æ¡ˆ**ï¼ˆAnt Designè‰²ç³»ï¼‰ï¼š

| ç”¨é€” | èƒŒæ™¯è‰² | è¾¹æ¡†è‰² | æ–‡å­—è‰² |
|------|--------|--------|--------|
| æ ¸å¿ƒèŠ‚ç‚¹ | `#1890ff` (è“) | `#096dd9` | `#fff` |
| ä¸šåŠ¡æ¨¡å— | `#52c41a` (ç»¿) | `#389e0d` | `#fff` |
| è­¦å‘Š/æ³¨æ„ | `#faad14` (æ©™) | `#d48806` | `#fff` |
| é”™è¯¯/å±é™© | `#f5222d` (çº¢) | `#cf1322` | `#fff` |
| ä¿¡æ¯/æç¤º | `#13c2c2` (é’) | `#08979c` | `#fff` |
| æ™®é€šèŠ‚ç‚¹ | `#ffffff` (ç™½) | `#d9d9d9` | `#000` |

**æ ·å¼æ¨¡æ¿**ï¼š

```plantuml
skinparam rectangle {
    BackgroundColor #1890ff
    BorderColor #096dd9
    FontColor #fff
}
```

### 2. æ ¼å¼æ£€æŸ¥ä¸ä¿®æ­£

#### æ£€æŸ¥é¡¹ï¼ˆæ ¹æ®CLAUDE.mdè§„èŒƒï¼‰

**ä¸‰å¤§æ ¸å¿ƒè§„åˆ™**ï¼š
1. æ ‡é¢˜å¿…é¡»é¡¶æ ¼ï¼Œæ— å‰å¯¼ç©ºæ ¼
2. æ ‡é¢˜å‰å¿…é¡»æœ‰ç©ºè¡Œ
3. ç« èŠ‚ç¼–å·è¦ç»Ÿä¸€è¿ç»­

**å…¶ä»–æ£€æŸ¥é¡¹**ï¼š
- åˆ—è¡¨æ ¼å¼æ­£ç¡®
- è¡¨æ ¼å‰åæœ‰ç©ºè¡Œ
- æ–‡ä»¶ç¼–ç ä¸ºUTF-8
- æ— ä¸å¿…è¦çš„è¡Œå°¾ç©ºæ ¼

#### æ‰§è¡Œå‘½ä»¤

```bash
# æ£€æŸ¥æ ‡é¢˜ç¼©è¿›
grep -n "^ #" file.md | grep -v "^#"

# æ£€æŸ¥ç©ºè¡Œé—®é¢˜
# ä½¿ç”¨Readå·¥å…·äººå·¥æ£€æŸ¥
```

### 3. ç›®å½•ç”Ÿæˆ

#### è‡ªåŠ¨ç”Ÿæˆç›®å½•

```markdown
## ç›®å½•

- [1 ç®€ä»‹](#1-ç®€ä»‹)
  - [1.1 ç›®çš„](#11-ç›®çš„)
  - [1.2 èŒƒå›´](#12-èŒƒå›´)
- [2 æ€»ä½“æ¦‚è¿°](#2-æ€»ä½“æ¦‚è¿°)
  ...
```

**ç”Ÿæˆè§„åˆ™**ï¼š
- é”šç‚¹è‡ªåŠ¨ç”Ÿæˆï¼šæ ‡é¢˜ä¸­çš„ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦
- ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»
- åªåŒ…å«2çº§å’Œ3çº§æ ‡é¢˜

### 4. å›¾ç‰‡ç®¡ç†

#### å›¾ç‰‡è·¯å¾„è§„èŒƒ

```markdown
# å½“å‰æ–‡æ¡£åœ¨ï¼šé¡¹ç›®æ–‡æ¡£/XXXç³»ç»Ÿ/XX_éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦/éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦.md
# å›¾ç‰‡å­˜æ”¾ï¼šé¡¹ç›®æ–‡æ¡£/images/
# ç›¸å¯¹è·¯å¾„ï¼š../../../images/xxx.png
```

#### å›¾ç‰‡å‘½åè§„èŒƒ

```
[é¡¹ç›®å]-[å›¾è¡¨ç±»å‹]-[åºå·].png

ä¾‹å¦‚ï¼š
HR-System-usecase-01.png
HR-System-sequence-01.png
HR-System-activity-01.png
```

## PlantUMLå›¾è¡¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç”¨ä¾‹å›¾

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆå·¥ä½œæ±‡æŠ¥æ¨¡å—ç”¨ä¾‹å›¾ï¼ŒåŒ…å«å‘˜å·¥å’Œä¸Šçº§ä¸¤ä¸ªè§’è‰²
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain
skinparam actorStyle awesome
skinparam packageStyle rectangle

left to right direction

actor "å‘˜å·¥" as Employee
actor "ä¸Šçº§/æ¥æ”¶äºº" as Manager

rectangle "å·¥ä½œæ±‡æŠ¥æ¨¡å—" {
    usecase "åˆ›å»ºå·¥ä½œæŠ¥å‘Š" as UC1
    usecase "æŸ¥çœ‹æˆ‘æäº¤çš„æŠ¥å‘Š" as UC2
    usecase "æŸ¥çœ‹æŠ¥å‘Šè¯¦æƒ…" as UC3
    usecase "æ›´æ–°å·¥ä½œæŠ¥å‘Š" as UC4
    usecase "åˆ é™¤å·¥ä½œæŠ¥å‘Š" as UC5
    usecase "æŸ¥çœ‹æˆ‘æ”¶åˆ°çš„æŠ¥å‘Š" as UC6
    usecase "å®¡é˜…å·¥ä½œæŠ¥å‘Š" as UC7
}

Employee --> UC1
Employee --> UC2
Employee --> UC3
Employee --> UC4
Employee --> UC5

Manager --> UC6
Manager --> UC3
Manager --> UC7

@enduml
```

### ç¤ºä¾‹2ï¼šæ—¶åºå›¾

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆç”¨æˆ·ç™»å½•æ—¶åºå›¾ï¼šç”¨æˆ· -> å‰ç«¯ -> åç«¯API -> æ•°æ®åº“
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain

participant "ç”¨æˆ·" as U
participant "å‰ç«¯" as F
participant "åç«¯API" as A
participant "æ•°æ®åº“" as D

U -> F: è¾“å…¥è´¦å·å¯†ç 
F -> A: POST /api/auth/login
A -> D: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
D --> A: è¿”å›ç”¨æˆ·æ•°æ®
A -> A: éªŒè¯å¯†ç 
A --> F: è¿”å›Token
F --> U: ç™»å½•æˆåŠŸ

@enduml
```

### ç¤ºä¾‹3ï¼šæ´»åŠ¨å›¾ï¼ˆæµç¨‹å›¾ï¼‰

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆè¯·å‡å®¡æ‰¹æµç¨‹å›¾ï¼šå‘˜å·¥æäº¤ç”³è¯· -> ç›´å±é¢†å¯¼å®¡æ‰¹ -> äººäº‹å®¡æ ¸ -> å®¡æ‰¹é€šè¿‡/é©³å›
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain

start
:å‘˜å·¥æäº¤è¯·å‡ç”³è¯·;
:ç›´å±é¢†å¯¼å®¡æ‰¹;
if (é¢†å¯¼å®¡æ‰¹ç»“æœ?) then (é€šè¿‡)
    :äººäº‹å®¡æ ¸;
    if (äººäº‹å®¡æ ¸ç»“æœ?) then (é€šè¿‡)
        :å®¡æ‰¹é€šè¿‡;
        :é€šçŸ¥å‘˜å·¥;
        stop
    else (é©³å›)
        :é€šçŸ¥å‘˜å·¥ä¿®æ”¹;
        stop
    endif
else (é©³å›)
    :é€šçŸ¥å‘˜å·¥;
    stop
endif

@enduml
```

### ç¤ºä¾‹4ï¼šæ³³é“å›¾

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆè·¨éƒ¨é—¨å®¡æ‰¹æ³³é“å›¾
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain

|å‘˜å·¥|
start
:æäº¤ç”³è¯·;

|éƒ¨é—¨é¢†å¯¼|
:å®¡æ‰¹ç”³è¯·;
if (æ˜¯å¦é€šè¿‡?) then (é€šè¿‡)
    |äººäº‹éƒ¨|
    :å®¡æ ¸èµ„æ–™;
    if (æ˜¯å¦é€šè¿‡?) then (é€šè¿‡)
        |è´¢åŠ¡éƒ¨|
        :å®¡æ ¸é¢„ç®—;
        if (æ˜¯å¦é€šè¿‡?) then (é€šè¿‡)
            :å®¡æ‰¹å®Œæˆ;
            stop
        else (é©³å›)
            |å‘˜å·¥|
            :æ”¶åˆ°é©³å›é€šçŸ¥;
            stop
        endif
    else (é©³å›)
        |å‘˜å·¥|
        :æ”¶åˆ°é©³å›é€šçŸ¥;
        stop
    endif
else (é©³å›)
    |å‘˜å·¥|
    :æ”¶åˆ°é©³å›é€šçŸ¥;
    stop
endif

@enduml
```

### ç¤ºä¾‹5ï¼šç±»å›¾

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆå‘˜å·¥ç®¡ç†ç±»å›¾
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain

class Employee {
    - id: bigint
    - name: string
    - email: string
    - phone: string
    - departmentId: bigint
    - positionId: bigint
    - status: string
    + create()
    + update()
    + delete()
}

class Department {
    - id: bigint
    - name: string
    - parentId: bigint
    + create()
    + update()
}

class Position {
    - id: bigint
    - name: string
    - level: string
    + create()
    + update()
}

Employee "n" --> "1" Department
Employee "n" --> "1" Position

@enduml
```

### ç¤ºä¾‹6ï¼šçŠ¶æ€å›¾

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”Ÿæˆå‘˜å·¥çŠ¶æ€æµè½¬å›¾
```

**PlantUMLä»£ç **ï¼š
```plantuml
@startuml
!theme plain

[*] --> è¯•ç”¨æœŸ
è¯•ç”¨æœŸ --> æ­£å¼å‘˜å·¥ : è½¬æ­£
è¯•ç”¨æœŸ --> ç¦»èŒ : è¯•ç”¨æœŸç¦»èŒ
æ­£å¼å‘˜å·¥ --> åœè–ªç•™èŒ : ç”³è¯·åœè–ªç•™èŒ
åœè–ªç•™èŒ --> æ­£å¼å‘˜å·¥ : æ¢å¤å·¥ä½œ
æ­£å¼å‘˜å·¥ --> ç¦»èŒ : æ­£å¼ç¦»èŒ
ç¦»èŒ --> [*]

@enduml
```

## è½¬æ¢è„šæœ¬

### plantuml-to-png.js

åœ¨ `scripts/plantuml-to-png.js` ä¸­åˆ›å»ºé€šç”¨è½¬æ¢è„šæœ¬ï¼š

```javascript
const fs = require('fs');
const https = require('https');
const zlib = require('zlib');
const path = require('path');

// PlantUMLç¼–ç å‡½æ•°
function encode64(data) {
    let r = '';
    for (let i = 0; i < data.length; i += 3) {
        if (i + 2 === data.length) {
            r += append3bytes(data[i], data[i + 1], 0);
        } else if (i + 1 === data.length) {
            r += append3bytes(data[i], 0, 0);
        } else {
            r += append3bytes(data[i], data[i + 1], data[i + 2]);
        }
    }
    return r;
}

function append3bytes(b1, b2, b3) {
    const c1 = b1 >> 2;
    const c2 = ((b1 & 0x3) << 4) | (b2 >> 4);
    const c3 = ((b2 & 0xF) << 2) | (b3 >> 6);
    const c4 = b3 & 0x3F;
    let r = '';
    r += encode6bit(c1 & 0x3F);
    r += encode6bit(c2 & 0x3F);
    r += encode6bit(c3 & 0x3F);
    r += encode6bit(c4 & 0x3F);
    return r;
}

function encode6bit(b) {
    if (b < 10) return String.fromCharCode(48 + b);
    b -= 10;
    if (b < 26) return String.fromCharCode(65 + b);
    b -= 26;
    if (b < 26) return String.fromCharCode(97 + b);
    b -= 26;
    if (b === 0) return '-';
    if (b === 1) return '_';
    return '?';
}

function encodePlantUML(text) {
    const compressed = zlib.deflateRawSync(Buffer.from(text, 'utf8'));
    return encode64(compressed);
}

async function downloadImage(url, filepath) {
    return new Promise((resolve, reject) => {
        const file = fs.createWriteStream(filepath);
        https.get(url, (response) => {
            if (response.statusCode !== 200) {
                reject(new Error(`HTTP ${response.statusCode}`));
                return;
            }
            response.pipe(file);
            file.on('finish', () => {
                file.close();
                resolve();
            });
        }).on('error', (err) => {
            fs.unlink(filepath, () => {});
            reject(err);
        });
    });
}

async function convertPumlToPng(pumlFile, outputFile) {
    try {
        const pumlContent = fs.readFileSync(pumlFile, 'utf8');
        const encoded = encodePlantUML(pumlContent);
        const url = `https://www.plantuml.com/plantuml/png/${encoded}`;

        console.log(`Converting ${pumlFile} to ${outputFile}...`);
        await downloadImage(url, outputFile);
        console.log(`âœ“ Generated ${outputFile}`);
        return true;
    } catch (error) {
        console.error(`âœ— Error converting ${pumlFile}:`, error.message);
        return false;
    }
}

// ä¸»å‡½æ•°
async function main() {
    const args = process.argv.slice(2);

    if (args.length < 2) {
        console.log('Usage: node plantuml-to-png.js <input.puml> <output.png>');
        console.log('   or: node plantuml-to-png.js <input1.puml> <input2.puml> ... (auto output to images/)');
        process.exit(1);
    }

    // ç¡®ä¿imagesç›®å½•å­˜åœ¨
    const imagesDir = path.join(process.cwd(), 'images');
    if (!fs.existsSync(imagesDir)) {
        fs.mkdirSync(imagesDir, { recursive: true });
    }

    if (args.length === 2) {
        // å•æ–‡ä»¶è½¬æ¢
        await convertPumlToPng(args[0], args[1]);
    } else {
        // æ‰¹é‡è½¬æ¢
        for (const pumlFile of args) {
            const basename = path.basename(pumlFile, '.puml');
            const outputFile = path.join(imagesDir, `${basename}.png`);
            await convertPumlToPng(pumlFile, outputFile);
        }
    }
}

main().catch(console.error);
```

## ä½¿ç”¨æµç¨‹

### å®Œæ•´å·¥ä½œæµç¨‹

1. **ç”¨æˆ·æå‡ºéœ€æ±‚**
   ```
   ç”ŸæˆXXXç”¨ä¾‹å›¾/æ—¶åºå›¾/æµç¨‹å›¾
   ```

2. **ç”ŸæˆPlantUMLä»£ç **
   - æ ¹æ®éœ€æ±‚ç¼–å†™PlantUMLä»£ç 
   - ä¿å­˜åˆ° `scripts/temp_xxx.puml`

3. **è½¬æ¢ä¸ºPNGå›¾ç‰‡**
   ```bash
   node scripts/plantuml-to-png.js scripts/temp_xxx.puml images/XXX-xxx-01.png
   ```

4. **æ’å…¥åˆ°Markdownæ–‡æ¡£**
   ```markdown
   ![å›¾è¡¨æè¿°](../../../images/XXX-xxx-01.png)
   ```

5. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**
   ```bash
   rm -f scripts/temp_*.puml
   ```

## æ³¨æ„äº‹é¡¹

### ç¯å¢ƒè¦æ±‚

**Node.jsç¯å¢ƒ**ï¼š
- éœ€è¦Node.js 14+
- å†…ç½®æ¨¡å—ï¼šfs, https, zlib, path
- æ— éœ€é¢å¤–å®‰è£…ä¾èµ–

### ç½‘ç»œè¦æ±‚

- éœ€è¦è®¿é—® `https://www.plantuml.com` åœ¨çº¿æœåŠ¡
- å¦‚æœç½‘ç»œå—é™ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°PlantUMLæœåŠ¡å™¨

### å›¾ç‰‡è´¨é‡

- PlantUMLåœ¨çº¿æœåŠ¡ç”Ÿæˆçš„PNGå›¾ç‰‡è´¨é‡è¾ƒé«˜
- é€‚åˆæ–‡æ¡£ä½¿ç”¨å’Œæ‰“å°
- å¦‚éœ€æ›´é«˜è´¨é‡ï¼Œå¯ä»¥ä½¿ç”¨SVGæ ¼å¼

### ä¸´æ—¶æ–‡ä»¶ç®¡ç†

æ¯æ¬¡æ‰§è¡Œå®Œå›¾è¡¨ç”Ÿæˆåï¼Œè‡ªåŠ¨æ¸…ç†ï¼š
```bash
rm -f scripts/temp_*.puml
rm -rf tmpclaude-*-cwd
```

### å¸¸è§é—®é¢˜

**Q: å›¾ç‰‡ç”Ÿæˆå¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥PlantUMLè¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œå¯ä»¥åœ¨ https://www.plantuml.com/plantuml/uml/ åœ¨çº¿æµ‹è¯•

**Q: ä¸­æ–‡æ˜¾ç¤ºä¹±ç æ€ä¹ˆåŠï¼Ÿ**
A: PlantUMLæ”¯æŒUTF-8ç¼–ç ï¼Œç¡®ä¿.pumlæ–‡ä»¶ä¿å­˜ä¸ºUTF-8æ ¼å¼

**Q: å¦‚ä½•è‡ªå®šä¹‰æ ·å¼ï¼Ÿ**
A: ä½¿ç”¨skinparamå‘½ä»¤è‡ªå®šä¹‰é¢œè‰²ã€å­—ä½“ç­‰æ ·å¼

**Q: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Mermaidï¼Ÿ**
A: å½“éœ€è¦åœ¨GitHub/GitLabä¸Šç›´æ¥å±•ç¤ºå›¾è¡¨ï¼Œæˆ–éœ€è¦å¿«é€Ÿç»˜åˆ¶æµç¨‹å›¾ã€æ€ç»´å¯¼å›¾æ—¶ï¼Œä½¿ç”¨Mermaidæ›´æ–¹ä¾¿

**Q: Mermaidå’ŒPlantUMLå¯ä»¥æ··ç”¨å—ï¼Ÿ**
A: å¯ä»¥ï¼åœ¨åŒä¸€é¡¹ç›®ä¸­ï¼Œæ­£å¼æ–‡æ¡£ä½¿ç”¨PlantUMLï¼ŒGitHubæ–‡æ¡£ä½¿ç”¨Mermaid

## Mermaid å¿«é€Ÿå‚è€ƒ

### ä½•æ—¶ä½¿ç”¨ Mermaid

å¦‚æœä½ çš„åœºæ™¯ç¬¦åˆä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œå»ºè®®ä½¿ç”¨ Mermaidï¼š
- âœ… åœ¨ GitHub/GitLab çš„ README.md æˆ– Wiki ä¸­å±•ç¤º
- âœ… éœ€è¦å¿«é€Ÿç»˜åˆ¶ç®€å•æµç¨‹å›¾
- âœ… éœ€è¦ç»˜åˆ¶æ€ç»´å¯¼å›¾
- âœ… å¸Œæœ›å›¾è¡¨ä»£ç ç›´æ¥åµŒå…¥ Markdownï¼ˆæ— éœ€è½¬PNGï¼‰

### Mermaid åŸºæœ¬è¯­æ³•

#### æµç¨‹å›¾
```markdown
\`\`\`mermaid
graph LR
    A[å¼€å§‹] --> B{åˆ¤æ–­}
    B -->|æ˜¯| C[æ“ä½œ1]
    B -->|å¦| D[æ“ä½œ2]
    C --> E[ç»“æŸ]
    D --> E
\`\`\`
```

#### æ—¶åºå›¾
```markdown
\`\`\`mermaid
sequenceDiagram
    ç”¨æˆ·->>å‰ç«¯: è¯·æ±‚
    å‰ç«¯->>åç«¯: APIè°ƒç”¨
    åç«¯-->>å‰ç«¯: è¿”å›æ•°æ®
    å‰ç«¯-->>ç”¨æˆ·: æ˜¾ç¤ºç»“æœ
\`\`\`
```

#### æ€ç»´å¯¼å›¾
```markdown
\`\`\`mermaid
mindmap
  root((ä¸»é¢˜))
    åˆ†æ”¯1
      å­é¡¹1
      å­é¡¹2
    åˆ†æ”¯2
      å­é¡¹3
      å­é¡¹4
\`\`\`
```

#### ç”˜ç‰¹å›¾
```markdown
\`\`\`mermaid
gantt
    title é¡¹ç›®è®¡åˆ’
    section é˜¶æ®µ1
    ä»»åŠ¡1 :a1, 2024-01-01, 30d
    ä»»åŠ¡2 :after a1, 20d
    section é˜¶æ®µ2
    ä»»åŠ¡3 :2024-02-01, 15d
\`\`\`
```

### Mermaid ä½¿ç”¨æ–¹å¼

**æ–¹å¼1ï¼šç›´æ¥åœ¨Markdownä¸­ä½¿ç”¨ï¼ˆæ¨èï¼‰**
```markdown
\`\`\`mermaid
graph LR
    A --> B
\`\`\`
```
- âœ… GitHub/GitLab ä¼šè‡ªåŠ¨æ¸²æŸ“
- âœ… æ— éœ€è½¬æ¢ä¸ºå›¾ç‰‡
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½

**æ–¹å¼2ï¼šè½¬æ¢ä¸ºPNGï¼ˆå¦‚éœ€ç¦»çº¿æ–‡æ¡£ï¼‰**
```bash
# å®‰è£… mermaid-cli
npm install -g @mermaid-js/mermaid-cli

# è½¬æ¢ä¸ºPNG
mmdc -i input.mmd -o output.png -b transparent
```

### Mermaid åœ¨çº¿å·¥å…·

- **Mermaid Live Editor**: https://mermaid.live/
- **å®˜æ–¹æ–‡æ¡£**: https://mermaid.js.org/
- **GitHubæ”¯æŒ**: ç›´æ¥åœ¨ä»£ç å—ä¸­ä½¿ç”¨ \`\`\`mermaid

## é€€å‡ºæ¡ä»¶

å½“å®Œæˆä»¥ä¸‹ä»»ä¸€æ“ä½œæ—¶ï¼Œç»“æŸskillæ‰§è¡Œï¼š
1. æˆåŠŸç”Ÿæˆå¹¶æ’å…¥å›¾ç‰‡
2. å®Œæˆæ ¼å¼æ£€æŸ¥å¹¶ä¿®æ­£
3. å®Œæˆç›®å½•ç”Ÿæˆ
4. ç”¨æˆ·æ˜ç¡®è¡¨ç¤ºæ»¡æ„æˆ–è¦æ±‚åœæ­¢
